<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
</head>

<body>
<h2> 결제 실패 </h2>
<p id="code"></p>
<p id="message"></p>
</body>
</html>

<script>
    const urlParams = new URLSearchParams(window.location.search);

    const orderId = urlParams.get("orderId");
    const codeElement = document.getElementById("code");
    const messageElement = document.getElementById("message");

    codeElement.textContent = "에러코드: " + urlParams.get("code");
    messageElement.textContent = "실패 사유: " + urlParams.get("message");


    async function fail() {

        const requestData = {
            orderId: orderId,
            errorCode: urlParams.get("code"),
            errorMessage: urlParams.get("message"),
        };
        console.log("보내는 데이터", requestData);

        const token = localStorage.getItem("accessToken");

        const response = await fetch("/api/v1/payment-fail", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${token}`

            },
            body: JSON.stringify(requestData),
        });

        if (!response.ok) {
            console.error("결제 실패 상태 업데이트 실패");
        }

    }
    fail();

</script>